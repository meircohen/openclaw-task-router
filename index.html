<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenClaw Task Router Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #00ff88;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .status.online { background: #00ff88; color: #000; }
        .status.offline { background: #ff4444; color: #fff; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #333;
        }

        .card h3 {
            color: #00ff88;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .progress-bar {
            background: #444;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc66);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-size: 0.8em;
            font-weight: bold;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #ffaa00, #ff8800);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #ff4444, #cc0000);
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #ccc;
        }

        .metric-value {
            font-weight: bold;
        }

        .metric-value.success { color: #00ff88; }
        .metric-value.warning { color: #ffaa00; }
        .metric-value.danger { color: #ff4444; }

        .queue-item {
            background: #333;
            border-radius: 5px;
            padding: 10px;
            margin: 5px 0;
            font-size: 0.9em;
        }

        .queue-priority {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-right: 10px;
        }

        .priority-critical { background: #ff4444; }
        .priority-high { background: #ffaa00; }
        .priority-normal { background: #0088ff; }
        .priority-low { background: #666; }

        .task-history {
            max-height: 300px;
            overflow-y: auto;
        }

        .task-item {
            background: #333;
            border-radius: 5px;
            padding: 8px;
            margin: 3px 0;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .task-status.success { background: #00ff88; }
        .task-status.failure { background: #ff4444; }

        .backend-tag {
            background: #555;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
        }

        .refresh-info {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin-top: 20px;
        }

        .error {
            background: #ff4444;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
        }

        .loading {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin: 50px 0;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>OpenClaw Task Router</h1>
            <span id="status" class="status offline">Connecting...</span>
        </div>

        <div id="error" class="error" style="display: none;">
            Failed to connect to router. Please ensure the router is running.
        </div>

        <div id="loading" class="loading">
            Loading dashboard data...
        </div>

        <div id="dashboard" style="display: none;">
            <!-- Backend Status -->
            <div class="grid">
                <div class="card">
                    <h3>Claude Code</h3>
                    <div class="metric">
                        <span class="metric-label">Status</span>
                        <span id="claude-status" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Session Usage</span>
                        <span id="claude-usage" class="metric-value">-</span>
                    </div>
                    <div class="progress-bar">
                        <div id="claude-progress" class="progress-fill" style="width: 0%">0%</div>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Tasks Completed</span>
                        <span id="claude-tasks" class="metric-value">-</span>
                    </div>
                </div>

                <div class="card">
                    <h3>Codex</h3>
                    <div class="metric">
                        <span class="metric-label">Status</span>
                        <span id="codex-status" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Active Sessions</span>
                        <span id="codex-sessions" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Usage</span>
                        <span id="codex-usage" class="metric-value">-</span>
                    </div>
                </div>

                <div class="card">
                    <h3>API Sub-agents</h3>
                    <div class="metric">
                        <span class="metric-label">Daily Budget</span>
                        <span id="api-daily" class="metric-value">-</span>
                    </div>
                    <div class="progress-bar">
                        <div id="api-daily-progress" class="progress-fill" style="width: 0%">0%</div>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Monthly Budget</span>
                        <span id="api-monthly" class="metric-value">-</span>
                    </div>
                    <div class="progress-bar">
                        <div id="api-monthly-progress" class="progress-fill" style="width: 0%">0%</div>
                    </div>
                </div>

                <div class="card">
                    <h3>Local Models</h3>
                    <div class="metric">
                        <span class="metric-label">Status</span>
                        <span id="local-status" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Available Models</span>
                        <span id="local-models" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Tasks Completed</span>
                        <span id="local-tasks" class="metric-value">-</span>
                    </div>
                </div>
            </div>

            <!-- Performance & Queue -->
            <div class="grid">
                <div class="card">
                    <h3>Performance Summary</h3>
                    <div class="metric">
                        <span class="metric-label">Overall Success Rate</span>
                        <span id="success-rate" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Total Tasks</span>
                        <span id="total-tasks" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Active Alerts</span>
                        <span id="active-alerts" class="metric-value">-</span>
                    </div>
                </div>

                <div class="card">
                    <h3>Task Queue</h3>
                    <div class="metric">
                        <span class="metric-label">Total Queued</span>
                        <span id="queue-total" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Ready Now</span>
                        <span id="queue-ready" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Dead Letters</span>
                        <span id="queue-dead" class="metric-value">-</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Scheduler</span>
                        <span id="scheduler-status" class="metric-value">-</span>
                    </div>
                </div>
            </div>

            <!-- Recent Tasks -->
            <div class="card">
                <h3>Recent Task Activity</h3>
                <div id="task-history" class="task-history">
                    <div class="loading">Loading recent tasks...</div>
                </div>
            </div>
        </div>

        <div class="refresh-info">
            Auto-refreshes every 30 seconds â€¢ Last updated: <span id="last-update">-</span>
        </div>
    </div>

    <script>
        let updateInterval;
        let lastUpdate = new Date();

        async function fetchRouterStatus() {
            try {
                // This would call the router's getStatus() function
                // For demo purposes, we'll simulate with setTimeout
                const response = await simulateRouterStatus();
                return response;
            } catch (error) {
                console.error('Error fetching router status:', error);
                throw error;
            }
        }

        // Simulate router status for demo
        function simulateRouterStatus() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve({
                        initialized: true,
                        backends: {
                            claudeCode: {
                                available: true,
                                usagePercentage: Math.random() * 70,
                                tasksCompleted: Math.floor(Math.random() * 50) + 10
                            },
                            codex: {
                                available: true,
                                activeSessions: Math.floor(Math.random() * 3),
                                usagePercentage: Math.random() * 60
                            },
                            api: {
                                enabled: true,
                                budget: {
                                    daily: '$12.50 / $50.00',
                                    monthly: '$145.30 / $500.00'
                                }
                            },
                            local: {
                                available: true,
                                models: ['deepseek-coder:latest', 'llama3:latest'],
                                taskCount: Math.floor(Math.random() * 20) + 5
                            }
                        },
                        performance: {
                            overallSuccessRate: '94.2%',
                            totalTasks: Math.floor(Math.random() * 500) + 100,
                            recentAlerts: Math.floor(Math.random() * 3)
                        },
                        queue: {
                            totalTasks: Math.floor(Math.random() * 10),
                            readyTasks: Math.floor(Math.random() * 3),
                            deadLetters: Math.floor(Math.random() * 2),
                            schedulerActive: true
                        }
                    });
                }, 500);
            });
        }

        function updateProgressBar(elementId, percentage, maxValue = 100) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const percent = Math.min(100, (percentage / maxValue) * 100);
            element.style.width = percent + '%';
            element.textContent = Math.round(percentage) + '%';

            // Color coding
            element.className = 'progress-fill';
            if (percent > 80) {
                element.classList.add('danger');
            } else if (percent > 60) {
                element.classList.add('warning');
            }
        }

        function updateDashboard(status) {
            // Update status indicator
            const statusElement = document.getElementById('status');
            statusElement.textContent = status.initialized ? 'Online' : 'Offline';
            statusElement.className = 'status ' + (status.initialized ? 'online' : 'offline');

            if (!status.initialized) return;

            // Claude Code
            document.getElementById('claude-status').textContent = 
                status.backends.claudeCode.available ? 'Available' : 'Unavailable';
            document.getElementById('claude-usage').textContent = 
                Math.round(status.backends.claudeCode.usagePercentage) + '%';
            document.getElementById('claude-tasks').textContent = 
                status.backends.claudeCode.tasksCompleted || '0';
            updateProgressBar('claude-progress', status.backends.claudeCode.usagePercentage, 100);

            // Codex
            document.getElementById('codex-status').textContent = 
                status.backends.codex.available ? 'Available' : 'Unavailable';
            document.getElementById('codex-sessions').textContent = 
                status.backends.codex.activeSessions + ' / 3';
            document.getElementById('codex-usage').textContent = 
                Math.round(status.backends.codex.usagePercentage) + '%';

            // API
            document.getElementById('api-daily').textContent = status.backends.api.budget.daily;
            document.getElementById('api-monthly').textContent = status.backends.api.budget.monthly;
            
            // Extract percentages from budget strings
            const dailyMatch = status.backends.api.budget.daily.match(/\$(\d+\.?\d*) \/ \$(\d+\.?\d*)/);
            if (dailyMatch) {
                const dailyPercent = (parseFloat(dailyMatch[1]) / parseFloat(dailyMatch[2])) * 100;
                updateProgressBar('api-daily-progress', dailyPercent, 100);
            }

            const monthlyMatch = status.backends.api.budget.monthly.match(/\$(\d+\.?\d*) \/ \$(\d+\.?\d*)/);
            if (monthlyMatch) {
                const monthlyPercent = (parseFloat(monthlyMatch[1]) / parseFloat(monthlyMatch[2])) * 100;
                updateProgressBar('api-monthly-progress', monthlyPercent, 100);
            }

            // Local
            document.getElementById('local-status').textContent = 
                status.backends.local.available ? 'Available' : 'Unavailable';
            document.getElementById('local-models').textContent = 
                status.backends.local.models ? status.backends.local.models.length : '0';
            document.getElementById('local-tasks').textContent = 
                status.backends.local.taskCount || '0';

            // Performance
            document.getElementById('success-rate').textContent = status.performance.overallSuccessRate;
            document.getElementById('total-tasks').textContent = status.performance.totalTasks;
            document.getElementById('active-alerts').textContent = status.performance.recentAlerts;

            // Queue
            document.getElementById('queue-total').textContent = status.queue.totalTasks;
            document.getElementById('queue-ready').textContent = status.queue.readyTasks;
            document.getElementById('queue-dead').textContent = status.queue.deadLetters;
            document.getElementById('scheduler-status').textContent = 
                status.queue.schedulerActive ? 'Running' : 'Stopped';

            // Update timestamp
            lastUpdate = new Date();
            document.getElementById('last-update').textContent = lastUpdate.toLocaleTimeString();

            // Show dashboard, hide loading/error
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        }

        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('status').textContent = 'Offline';
            document.getElementById('status').className = 'status offline';
        }

        async function refresh() {
            try {
                const status = await fetchRouterStatus();
                updateDashboard(status);
            } catch (error) {
                console.error('Failed to update dashboard:', error);
                showError();
            }
        }

        // Initialize dashboard
        async function init() {
            await refresh();
            
            // Set up auto-refresh
            updateInterval = setInterval(refresh, 30000); // 30 seconds
        }

        // Start when page loads
        document.addEventListener('DOMContentLoaded', init);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>